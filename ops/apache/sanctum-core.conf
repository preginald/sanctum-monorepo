<VirtualHost *:80>
    ServerName core.digitalsanctum.com.au
    ServerAdmin engineering@digitalsanctum.com.au

    # --- 1. THE REVERSE PROXY (API) ---
    # Routes https://core.../api/token -> http://localhost:8000/token
    ProxyPreserveHost On
    ProxyPass /api/ http://127.0.0.1:8000/
    ProxyPassReverse /api/ http://127.0.0.1:8000/

    # --- 2. THE FRONTEND (React) ---
    DocumentRoot /var/www/sanctum-core
    <Directory /var/www/sanctum-core>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        # React Router Rewrites
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/sanctum-error.log
    CustomLog ${APACHE_LOG_DIR}/sanctum-access.log combined
RewriteCond %{SERVER_NAME} =core.digitalsanctum.com.au
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>
